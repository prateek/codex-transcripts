{
  "id": "019b5136-f598-7431-90ae-03925024249f",
  "timestamp": "2025-12-24T16:35:14.968Z",
  "cwd": "/Users/jeno/src/elixir/DemoBank",
  "originator": "codex_vscode",
  "cli_version": "0.77.0",
  "instructions": "# Agent Notes (DemoBank)\n\n## Context Export (For ChatGPT Web)\n\n- Run `./bin/export-context [output.zip]` to generate an uploadable context pack (defaults to `chatgpt-context.zip`).\n- Keep [.chatgpt_context/SUMMARY.md](.chatgpt_context/SUMMARY.md) updated when architecture/roles/endpoints change.\n- The export intentionally excludes [deps/](deps/), [_build/](_build/), and `priv/Mnesia*`.\n\n## Architecture Constraints\n\n- `BANK_ROLE` selects role: `dashboard`, `worker`, `generator`.\n- Dashboard/generator must not join the worker Erlang cluster; cross-boundary calls are REST only.\n\n## Extending Tests & Coverage\n\n- New modules should get a sibling test under [test/bank_core/](test/bank_core/) or [test/bank_web/](test/bank_web/), following existing naming (e.g., `*_test.exs`).\n- If a module depends on Mnesia tables, use helpers in [test/support/idempotency_test_helpers.ex](test/support/idempotency_test_helpers.ex) to ensure tables are created; add new table specs to `ensure_all_tables!/0` if needed.\n- For REST endpoints, add/request tests under [test/bank_web/worker_api_controller_test.exs](test/bank_web/worker_api_controller_test.exs) (or a new controller test) and keep [config/test.exs](config/test.exs) aligned with any new dev routes.\n- Update [test/TESTING.md](test/TESTING.md) with any new setup/seed steps or helper functions that a newcomer needs to run the tests.\n- Coverage: run `mix coveralls.html` to generate [cover/excoveralls.html](cover/excoveralls.html). Add new modules to the coverage set by adding tests that execute their public APIs and edge cases; avoid private-function coverage by behavior.\n- Coverage guidance: normal-branch coverage should be achieved without mocks; error-branch tests may use `:meck` to stub store calls and exercise defensive paths.\n\n## Agentic workflow (Codex)\n\n### Roles & responsibilities (overview)\n\n| Role | Responsibility | Output |\n| --- | --- | --- |\n| Spec Agent | Clarifies requirements, acceptance criteria, NFRs, edge cases, open questions. | Spec artifact |\n| BIAN Domain Expert Agent | Validates domain decomposition and BIAN semantic alignment; records mappings and deviations. | Domain review |\n| Plan Agent | Produces implementable plan referencing Spec; steps, files, risks, tests. | Plan artifact |\n| Orchestrator Agent | Coordinates end-to-end workflow; verifies gates/artifacts; issues next-step prompts. | Orchestration note |\n| Code Agent | Implements approved plan with minimal diffs; no speculative changes. | Code changes |\n| Test Agent | Runs relevant checks; writes test report with commands/results. | Test report |\n| Review Agent | Checks plan compliance, correctness, maintainability, compatibility. | Review note |\n| Security/Dependency Agent | Reviews new deps, network usage, auth changes, secrets handling. | Security note |\n\n### Handoff protocol (gated)\n\n1) **Gate 1: Spec approved** — Spec artifact exists and includes acceptance criteria.  \n2) **Gate 1b: BIAN Domain Review** — Required when trigger rules apply (may run in parallel with planning; Plan must reference final review before coding).  \n3) **Gate 2: Plan approved** — Plan references the Spec and Domain Review (if triggered) and includes validation steps.  \n4) **Gate 3: Code complete** — Code changes align with the Plan and are scoped.  \n5) **Gate 4: Test report** — Commands and results documented.  \n6) **Gate 5: Review + Security signoff** when any of:\n   - New dependency\n   - New external call / network access\n   - Authn/authz changes\n   - Data model migration\n   - Public API changes\n\n### BIAN Domain Review trigger rules\n\nRun the BIAN Domain Expert Agent when any of the following apply:\n- New or changed service boundary (new SD, merged/split domains).\n- New or changed external/public API contract representing banking semantics (REST/GraphQL/events).\n- Changes to core domain entities (accounts, positions, ledger postings, limits, holds, fees, product terms).\n- New Control Record / Behavior Qualifier lifecycle modeling.\n- Risk of cross-domain data ownership ambiguity (golden-source conflicts).\n\n### Artifact convention\n\nStore workflow artifacts under [docs/agentic/](docs/agentic/) (create folders as needed):\n- Spec: [`docs/agentic/specs/<id>.md`](docs/agentic/specs/<id>.md)\n- BIAN Domain Review: [`docs/agentic/domain-reviews/bian/<id>.md`](docs/agentic/domain-reviews/bian/<id>.md)\n- Plan: [`docs/agentic/plans/<id>.md`](docs/agentic/plans/<id>.md)\n- Orchestration: [`docs/agentic/orchestration/<id>.md`](docs/agentic/orchestration/<id>.md)\n- Tests: [`docs/agentic/test-reports/<id>.md`](docs/agentic/test-reports/<id>.md)\n- Review: [`docs/agentic/reviews/<id>.md`](docs/agentic/reviews/<id>.md)\n- Security: [`docs/agentic/security/<id>.md`](docs/agentic/security/<id>.md)\n\n### Standard commands (repo-specific)\n\n- Setup: `mix setup`\n- Format: `mix format`\n- Unit/All tests (requires distributed node):\n  - `elixir --sname bank_test --cookie bank_test_cookie -S mix test`\n- Coverage:\n  - `elixir --sname bank_test --cookie bank_test_cookie -S mix coveralls.html`\n- Dialyzer:\n  - `mix dialyzer`\n- Lint:\n  - `mix credo`\n- Integration tests:\n  - TODO: confirm if there is a dedicated integration test command.\n\n### Approval guidance (read-only vs write modes)\n\n- **Read-only**: Spec, Plan, Review, Security agents.\n- **Write**: Code and Test agents, only after Spec/Plan approval.\n\n### Definition of Done (DoD)\n\n- Spec + Plan artifacts exist and are linked in the work item.\n- Code changes align with the plan; no unrelated refactors.\n- Tests added/updated for changed behavior.\n- Relevant commands executed (or CI relied upon) and results documented.\n- Review + Security notes completed when triggered.\n- BIAN Domain Review completed and referenced in the Plan when trigger rules apply.\n\n### Integration/Commit step (optional)\n- Use `commit-agent` after all required gates are green and tests are passing to verify scope, run standard checks, and create/push a commit for the `<id>` work item.\n\n### Commit and Push Policy (formal)\n\nThis repository treats agentic artifacts as first-class engineering records. Commits must be traceable to a single work identifier (`<id>`), scoped, and safe to publish to GitHub.\n\n#### Scope and branch discipline\n- All work must be performed on a non-main branch (feature/topic branch). Do not push directly to `main`.\n- A commit must be attributable to exactly one `<id>` (e.g., `pk-events-9a`). If multiple work items are in progress, separate them by branch or commit series.\n- Avoid mixing unrelated refactors with behavior changes. If unavoidable, split into separate commits and document the rationale.\n\n#### What must be included in commits\nFor a given `<id>`, the following MUST be committed when they exist (unless explicitly marked as internal-only for local experimentation):\n\n- **Spec**: [`docs/agentic/specs/<id>.md`](docs/agentic/specs/<id>.md)\n- **Plan**: [`docs/agentic/plans/<id>.md`](docs/agentic/plans/<id>.md)\n- **Test report**: [`docs/agentic/test-reports/<id>.md`](docs/agentic/test-reports/<id>.md) (keep concise: commands + pass/fail + key notes)\n- **Review note** (when Gate 5 applies or when requested): [`docs/agentic/reviews/<id>.md`](docs/agentic/reviews/<id>.md)\n- **Security note** (when Gate 5 applies): [`docs/agentic/security/<id>.md`](docs/agentic/security/<id>.md)\n- **BIAN Domain Review** (when trigger rules apply / Gate 1b): [`docs/agentic/domain-reviews/bian/<id>.md`](docs/agentic/domain-reviews/bian/<id>.md)\n\nThe artifacts must reflect the final decision state used for implementation (avoid committing stale drafts).\n\n#### What must NOT be committed\nDo not commit:\n- Secrets of any kind (tokens, cookies, API keys, credentials), even if test-only.\n- Any customer data, production identifiers, or other sensitive/regulated information.\n- Full raw logs, environment dumps, stack traces that contain hostnames, internal IPs, tokens, or PII.\n- Large generated outputs (e.g., [_build/](_build/), [deps/](deps/), coverage HTML) unless explicitly required and reviewed.\n\nIf diagnostic information is needed, summarize it in the relevant [docs/agentic/](docs/agentic/) artifact with redaction.\n\n#### Commit message standard\nUse one of the following formats:\n- `<id>: <short imperative summary>`\n- `<id> (<area>): <short imperative summary>` (e.g., `pk-events-9a (pk): add namespaced event envelope v1`)\n\nIf multiple commits are used for a single `<id>`, all commits must start with `<id>:`.\n\n#### Pre-commit / pre-push gates (minimum)\nBefore pushing a commit for `<id>`, ensure:\n- `mix format` has been run if formatting changes are expected.\n- Lint passes: `mix credo`\n- Tests pass (distributed): `elixir --sname bank_test --cookie bank_test_cookie -S mix test`\n- Required artifacts for the applicable gates exist and are consistent (Spec/Plan always; Domain/Security/Review when triggered).\n- `git status` is clean (or only includes intentionally uncommitted changes clearly unrelated to `<id>`).\n\nIf any gate fails, do not push; remediate or update the plan/spec via the proper agent flow.\n\n#### Artifact update policy (when fixes happen)\n- If implementation deviates from the approved plan/spec for legitimate reasons, update the Plan/Spec artifacts in the same `<id>` branch and explain the reason.\n- If the Test Agent or Review Agent identifies blocking issues, the remediation commit(s) must still carry the same `<id>` prefix and the updated Test/Review artifacts must reflect the final green/approved state.\n\n#### PR readiness (recommended)\nA branch is PR-ready when:\n- All applicable gates are satisfied (including Domain/Security/Review where triggered),\n- The repo standard commands are green locally (or the limitations are explicitly documented),\n- Agentic artifacts are committed and match the delivered code.\n\n\n## Skills\nThese skills are discovered at startup from multiple local sources. Each entry includes a name, description, and file path so you can open the source for full instructions.\n- bian-domain-agent: Validate domain decomposition and semantic alignment to BIAN; produce mapping + deviation record. (file: /Users/jeno/src/elixir/DemoBank/.codex/skills/bian-domain-agent/SKILL.md)\n- code-agent: Implement the approved plan with minimal, focused diffs; remediate test failures; address review feedback with clear blocking/non-blocking handling. (file: /Users/jeno/src/elixir/DemoBank/.codex/skills/code-agent/SKILL.md)\n- commit-agent: Integrate approved work by verifying artifacts/approvals, running lint/tests, committing, and pushing. (file: /Users/jeno/src/elixir/DemoBank/.codex/skills/commit-agent/SKILL.md)\n- plan-agent: Turn an approved spec into an implementable, step-by-step plan. (file: /Users/jeno/src/elixir/DemoBank/.codex/skills/plan-agent/SKILL.md)\n- review-agent: Perform an independent review against spec/plan and produce findings. (file: /Users/jeno/src/elixir/DemoBank/.codex/skills/review-agent/SKILL.md)\n- security-agent: Assess security, dependency, and network risks for proposed changes. (file: /Users/jeno/src/elixir/DemoBank/.codex/skills/security-agent/SKILL.md)\n- skill-creator: Guide for creating effective skills. This skill should be used when users want to create a new skill (or update an existing skill) that extends Codex's capabilities with specialized knowledge, workflows, or tool integrations. (file: /Users/jeno/.codex/skills/.system/skill-creator/SKILL.md)\n- skill-installer: Install Codex skills into $CODEX_HOME/skills from a curated list or a GitHub repo path. Use when a user asks to list installable skills, install a curated skill, or install a skill from another repo (including private repos). (file: /Users/jeno/.codex/skills/.system/skill-installer/SKILL.md)\n- spec-agent: Convert a request into a crisp functional spec with acceptance criteria; incorporate domain-review blockers into an updated, unambiguous contract. (file: /Users/jeno/src/elixir/DemoBank/.codex/skills/spec-agent/SKILL.md)\n- test-agent: Run relevant tests and produce a structured test report. (file: /Users/jeno/src/elixir/DemoBank/.codex/skills/test-agent/SKILL.md)\n- Discovery: Available skills are listed in project docs and may also appear in a runtime \"## Skills\" section (name + description + file path). These are the sources of truth; skill bodies live on disk at the listed paths.\n- Trigger rules: If the user names a skill (with `$SkillName` or plain text) OR the task clearly matches a skill's description, you must use that skill for that turn. Multiple mentions mean use them all. Do not carry skills across turns unless re-mentioned.\n- Missing/blocked: If a named skill isn't in the list or the path can't be read, say so briefly and continue with the best fallback.\n- How to use a skill (progressive disclosure):\n  1) After deciding to use a skill, open its `SKILL.md`. Read only enough to follow the workflow.\n  2) If `SKILL.md` points to extra folders such as `references/`, load only the specific files needed for the request; don't bulk-load everything.\n  3) If `scripts/` exist, prefer running or patching them instead of retyping large code blocks.\n  4) If `assets/` or templates exist, reuse them instead of recreating from scratch.\n- Description as trigger: The YAML `description` in `SKILL.md` is the primary trigger signal; rely on it to decide applicability. If unsure, ask a brief clarification before proceeding.\n- Coordination and sequencing:\n  - If multiple skills apply, choose the minimal set that covers the request and state the order you'll use them.\n  - Announce which skill(s) you're using and why (one short line). If you skip an obvious skill, say why.\n- Context hygiene:\n  - Keep context small: summarize long sections instead of pasting them; only load extra files when needed.\n  - Avoid deeply nested references; prefer one-hop files explicitly linked from `SKILL.md`.\n  - When variants exist (frameworks, providers, domains), pick only the relevant reference file(s) and note that choice.\n- Safety and fallback: If a skill can't be applied cleanly (missing files, unclear instructions), state the issue, pick the next-best approach, and continue.",
  "source": "vscode",
  "model_provider": "openai",
  "git": {
    "commit_hash": "725dcbcbe1807cc92a03968c4bc74d7890170a0c",
    "branch": "pk-implementation-9c",
    "repository_url": "https://github.com/jeno007/DemoBank.git"
  }
}
